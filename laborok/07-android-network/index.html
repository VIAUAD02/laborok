
<!doctype html>
<html lang="hu" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Tóth Tibor, Gincsai Gábor, Ekler Péter, Gazdi László, Pomázi Krisztián, Kövesdán Gábor">
      
      
      
        <link rel="prev" href="../06-android-room/">
      
      
        <link rel="next" href="../08-http/">
      
      <link rel="icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.4">
    
    
      
        <title>Labor 07 - Retrofit - Időjárás alkalmazás - BMEVIAUAD02 - Mobil- és webes szoftverek laborfeladatok</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.9c788c91.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/timeago.css">
    
      <link rel="stylesheet" href="../../extra-material-theme.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="aut" data-md-color-primary="red" data-md-color-accent="red">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#labor-07-retrofit-idojaras-alkalmazas" class="md-skip">
          Kihagyás
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Élőfej">
    <a href="../.." title="BMEVIAUAD02 - Mobil- és webes szoftverek laborfeladatok" class="md-header__button md-logo" aria-label="BMEVIAUAD02 - Mobil- és webes szoftverek laborfeladatok" data-md-component="logo">
      
  <img src="../../logo-bme-aut.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BMEVIAUAD02 - Mobil- és webes szoftverek laborfeladatok
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Labor 07 - Retrofit - Időjárás alkalmazás
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="aut" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Váltás sötét témára"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Váltás sötét témára" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent=""  aria-label="Váltás világos témára"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Váltás világos témára" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Keresés" placeholder="Keresés" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Törlés" aria-label="Törlés" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Keresés inicializálása
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/viauad02/laborok" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    viauad02/laborok
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Lapok" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        Tudnivalók
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../01-android-hello-world/" class="md-tabs__link md-tabs__link--active">
        Mobil Laborok
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../08-http/" class="md-tabs__link">
        Webes Laborok
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigáció" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BMEVIAUAD02 - Mobil- és webes szoftverek laborfeladatok" class="md-nav__button md-logo" aria-label="BMEVIAUAD02 - Mobil- és webes szoftverek laborfeladatok" data-md-component="logo">
      
  <img src="../../logo-bme-aut.png" alt="logo">

    </a>
    BMEVIAUAD02 - Mobil- és webes szoftverek laborfeladatok
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/viauad02/laborok" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    viauad02/laborok
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" tabindex="0" aria-expanded="false">
          Tudnivalók
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tudnivalók" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Tudnivalók
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Tárgy ismertető
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/GitHub/" class="md-nav__link">
        Feladatok beadása (GitHub)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/GitHub-Actions/" class="md-nav__link">
        GitHub Actions ismertető
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/GitHub-credentials/" class="md-nav__link">
        Egyetemi laborokban: GitHub belépés
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/contributing/" class="md-nav__link">
        Hozzájárulás az anyaghoz
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" tabindex="0" aria-expanded="true">
          Mobil Laborok
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Mobil Laborok" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Mobil Laborok
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01-android-hello-world/" class="md-nav__link">
        Labor 01 - Hello World
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../02-android-ui/" class="md-nav__link">
        Labor 02 - UI - Tömegközlekedési alkalmazás
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../03-android-ui-adv/" class="md-nav__link">
        Labor 03 - UI, LazyColumn - Kiadás és bevétel kezelő alkalmazás
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../04-android-ui-charts/" class="md-nav__link">
        Labor 04 - UI,HorizontalPager, Charts - HR alkalmazás
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05-android-sqlite/" class="md-nav__link">
        Labor 05 - SQLite - Rajzoló alkalmazás
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../06-android-room/" class="md-nav__link">
        Labor 06 - Room - Bevásárló lista alkalmazás
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Labor 07 - Retrofit - Időjárás alkalmazás
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Labor 07 - Retrofit - Időjárás alkalmazás
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bevezeto" class="md-nav__link">
    Bevezető
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#az-alkalmazas-specifikacioja" class="md-nav__link">
    Az alkalmazás specifikációja
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laborfeladatok" class="md-nav__link">
    Laborfeladatok
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elokeszuletek" class="md-nav__link">
    Előkészületek
  </a>
  
    <nav class="md-nav" aria-label="Előkészületek">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#git-repository-letrehozasa-es-letoltese" class="md-nav__link">
    Git repository létrehozása és letöltése
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#projekt-letrehozasa" class="md-nav__link">
    Projekt létrehozása
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fuggosegek-felvetele" class="md-nav__link">
    Függőségek felvétele
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#engedelyek-felvetele" class="md-nav__link">
    Engedélyek felvétele
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eroforrasok-hozzaadasa" class="md-nav__link">
    Erőforrások hozzáadása
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openweathermap-api-kulcs" class="md-nav__link">
    OpenWeatherMap API kulcs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#varoslista-megvalositasa-1-pont" class="md-nav__link">
    Városlista megvalósítása (1 pont)
  </a>
  
    <nav class="md-nav" aria-label="Városlista megvalósítása (1 pont)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#az-architektura-kialakitasa" class="md-nav__link">
    Az architektúra kialakítása
  </a>
  
    <nav class="md-nav" aria-label="Az architektúra kialakítása">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-modell-osztaly" class="md-nav__link">
    A modell osztály
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-repository" class="md-nav__link">
    A repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-viewmodel" class="md-nav__link">
    A ViewModel
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-varoslista-kepernyo-megvalositasa" class="md-nav__link">
    A városlista képernyő megvalósítása
  </a>
  
    <nav class="md-nav" aria-label="A városlista képernyő megvalósítása">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-komponensek-elkeszitese" class="md-nav__link">
    A komponensek elkészítése
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-citylistscreen-elkeszitese" class="md-nav__link">
    A CityListScreen elkészítése
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-navigacio-elkeszitese" class="md-nav__link">
    A navigáció elkészítése
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#az-idojaras-nezet-letrehozasa-es-bekotese-a-navigacioba-2-pont" class="md-nav__link">
    Az időjárás nézet létrehozása és bekötése a navigációba (2 pont)
  </a>
  
    <nav class="md-nav" aria-label="Az időjárás nézet létrehozása és bekötése a navigációba (2 pont)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#az-architektura-kialakitasa_1" class="md-nav__link">
    Az architektúra kialakítása
  </a>
  
    <nav class="md-nav" aria-label="Az architektúra kialakítása">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modell-osztalyok" class="md-nav__link">
    Modell osztályok
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repository" class="md-nav__link">
    Repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-viewmodel_1" class="md-nav__link">
    A ViewModel
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#az-idojaras-felulet" class="md-nav__link">
    Az időjárás felület
  </a>
  
    <nav class="md-nav" aria-label="Az időjárás felület">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#komponensek" class="md-nav__link">
    Komponensek
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-weatherscreen-elkeszitese" class="md-nav__link">
    A WeatherScreen elkészítése
  </a>
  
    <nav class="md-nav" aria-label="A WeatherScreen elkészítése">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bekotes-a-navigacioba" class="md-nav__link">
    Bekötés a navigációba
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-halozati-kommunikacio-elkeszitese-1-pont" class="md-nav__link">
    A Hálózati kommunikáció elkészítése (1 pont)
  </a>
  
    <nav class="md-nav" aria-label="A Hálózati kommunikáció elkészítése (1 pont)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-weatherapi-megvalositasa" class="md-nav__link">
    A WeatherAPI megvalósítása
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-retrofitweatherrepository-frissitese" class="md-nav__link">
    A RetrofitWeatherRepository frissítése
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onallo-feladat-varos-listabol-torles-megvalositasa-1-pont" class="md-nav__link">
    Önálló feladat: város listából törlés megvalósítása (1 pont)
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" tabindex="0" aria-expanded="false">
          Webes Laborok
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Webes Laborok" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Webes Laborok
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../08-http/" class="md-nav__link">
        Labor 08 - HTTP, HTML
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../09-css/" class="md-nav__link">
        Labor 09 - CSS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../10-bootstrap/" class="md-nav__link">
        Labor 10 - Bootstrap
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../11-js/" class="md-nav__link">
        Labor 11 - JavaScript alapok
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../12-js-advanced/" class="md-nav__link">
        Labor 12 - Haladó JavaScript
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../13-jquery/" class="md-nav__link">
        Labor 13 - jQuery
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bevezeto" class="md-nav__link">
    Bevezető
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#az-alkalmazas-specifikacioja" class="md-nav__link">
    Az alkalmazás specifikációja
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#laborfeladatok" class="md-nav__link">
    Laborfeladatok
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elokeszuletek" class="md-nav__link">
    Előkészületek
  </a>
  
    <nav class="md-nav" aria-label="Előkészületek">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#git-repository-letrehozasa-es-letoltese" class="md-nav__link">
    Git repository létrehozása és letöltése
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#projekt-letrehozasa" class="md-nav__link">
    Projekt létrehozása
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fuggosegek-felvetele" class="md-nav__link">
    Függőségek felvétele
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#engedelyek-felvetele" class="md-nav__link">
    Engedélyek felvétele
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eroforrasok-hozzaadasa" class="md-nav__link">
    Erőforrások hozzáadása
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openweathermap-api-kulcs" class="md-nav__link">
    OpenWeatherMap API kulcs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#varoslista-megvalositasa-1-pont" class="md-nav__link">
    Városlista megvalósítása (1 pont)
  </a>
  
    <nav class="md-nav" aria-label="Városlista megvalósítása (1 pont)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#az-architektura-kialakitasa" class="md-nav__link">
    Az architektúra kialakítása
  </a>
  
    <nav class="md-nav" aria-label="Az architektúra kialakítása">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-modell-osztaly" class="md-nav__link">
    A modell osztály
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-repository" class="md-nav__link">
    A repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-viewmodel" class="md-nav__link">
    A ViewModel
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-varoslista-kepernyo-megvalositasa" class="md-nav__link">
    A városlista képernyő megvalósítása
  </a>
  
    <nav class="md-nav" aria-label="A városlista képernyő megvalósítása">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-komponensek-elkeszitese" class="md-nav__link">
    A komponensek elkészítése
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-citylistscreen-elkeszitese" class="md-nav__link">
    A CityListScreen elkészítése
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-navigacio-elkeszitese" class="md-nav__link">
    A navigáció elkészítése
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#az-idojaras-nezet-letrehozasa-es-bekotese-a-navigacioba-2-pont" class="md-nav__link">
    Az időjárás nézet létrehozása és bekötése a navigációba (2 pont)
  </a>
  
    <nav class="md-nav" aria-label="Az időjárás nézet létrehozása és bekötése a navigációba (2 pont)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#az-architektura-kialakitasa_1" class="md-nav__link">
    Az architektúra kialakítása
  </a>
  
    <nav class="md-nav" aria-label="Az architektúra kialakítása">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modell-osztalyok" class="md-nav__link">
    Modell osztályok
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repository" class="md-nav__link">
    Repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-viewmodel_1" class="md-nav__link">
    A ViewModel
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#az-idojaras-felulet" class="md-nav__link">
    Az időjárás felület
  </a>
  
    <nav class="md-nav" aria-label="Az időjárás felület">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#komponensek" class="md-nav__link">
    Komponensek
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-weatherscreen-elkeszitese" class="md-nav__link">
    A WeatherScreen elkészítése
  </a>
  
    <nav class="md-nav" aria-label="A WeatherScreen elkészítése">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bekotes-a-navigacioba" class="md-nav__link">
    Bekötés a navigációba
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-halozati-kommunikacio-elkeszitese-1-pont" class="md-nav__link">
    A Hálózati kommunikáció elkészítése (1 pont)
  </a>
  
    <nav class="md-nav" aria-label="A Hálózati kommunikáció elkészítése (1 pont)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-weatherapi-megvalositasa" class="md-nav__link">
    A WeatherAPI megvalósítása
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-retrofitweatherrepository-frissitese" class="md-nav__link">
    A RetrofitWeatherRepository frissítése
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onallo-feladat-varos-listabol-torles-megvalositasa-1-pont" class="md-nav__link">
    Önálló feladat: város listából törlés megvalósítása (1 pont)
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<h1 id="labor-07-retrofit-idojaras-alkalmazas">Labor 07 - Retrofit - Időjárás alkalmazás<a class="headerlink" href="#labor-07-retrofit-idojaras-alkalmazas" title="Permanent link">&para;</a></h1>
<h2 id="bevezeto">Bevezető<a class="headerlink" href="#bevezeto" title="Permanent link">&para;</a></h2>
<p>A labor során egy időjárás információkat megjelenítő alkalmazás elkészítése a feladat. A korábban látott UI elemek használata mellett láthatunk majd példát hálózati kommunkáció hatékony megvalósítására is a <a href="https://square.github.io/retrofit/"><code>Retrofit</code></a> könyvtár felhasználásával.</p>
<p>Az alkalmazás városok listáját jeleníti meg egy <a href="https://developer.android.com/develop/ui/compose/lists"><code>LazyColumn</code></a>-ban, a kiválasztott város időjárás adatait pedig az <a href="https://openweathermap.org/">OpenWeatherMap</a> <em>REST API</em>-jának segítségével kérdezi le.  Új város hozzáadására egy  <a href="https://developer.android.com/guide/topics/ui/floating-action-button"><code>FloatingActionButton</code></a> megnyomásával van lehetőség. </p>
<div class="admonition info">
<p class="admonition-title">REST</p>
<p>REST = <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">Representational State Transfer</a></p>
</div>
<p>Felhasznált technológiák: </p>
<ul>
<li><a href="https://developer.android.com/guide/components/activities/intro-activities"><code>Activity</code></a></li>
<li><a href="https://developer.android.com/develop/ui/compose/lists"><code>LazyColumn</code></a></li>
<li><a href="https://square.github.io/retrofit/"><code>Retrofit</code></a></li>
<li><a href="https://github.com/square/moshi"><code>Moshi</code></a></li>
<li><a href="https://github.com/coil-kt/coil"><code>Coil</code></a></li>
<li><a href="https://developer.android.com/topic/libraries/architecture/viewmodel"><code>ViewModel</code></a></li>
<li><a href="https://developer.android.com/develop/ui/compose/navigation"><code>NavHost</code></a></li>
<li><a href="https://developer.android.com/reference/kotlin/androidx/compose/material3/package-summary#SwipeToDismissBox(androidx.compose.material3.SwipeToDismissBoxState,kotlin.Function1,androidx.compose.ui.Modifier,kotlin.Boolean,kotlin.Boolean,kotlin.Boolean,kotlin.Function1)"><code>SwipeToDismissBox</code></a></li>
</ul>
<h2 id="az-alkalmazas-specifikacioja">Az alkalmazás specifikációja<a class="headerlink" href="#az-alkalmazas-specifikacioja" title="Permanent link">&para;</a></h2>
<p>Az alkalmazás egy <code>Activity</code>-ből áll. </p>
<p>Az alkalmazás indulásakor megjelenő <code>CityListScreen</code> a felhasználó által felvett városok listáját jeleníti meg. A városokat balra elhúzva az adott város törlődik a listából. Új várost a nézet jobb alsó sarkában található <code>FloatingActionButton</code> megnyomásával lehet felvenni.</p>
<p>Egy városra való kattintás hatására a <code>NavGraph</code> segítségével egy új <em>Composable</em> képernyőt hozunk előtérbe az adott város időjárás adataival. A rövid jellemzés mellett egy akutális ikon és a  városban mért átlagos, minimum és maximum hőmérséklet, a légnyomás és a páratartalom értéke látható.</p>
<p align="center">
<img src="./assets/list.png" width="240">
<img src="./assets/dialog.png" width="240">
<img src="./assets/weather.png" width="240">
</p>

<h2 id="laborfeladatok">Laborfeladatok<a class="headerlink" href="#laborfeladatok" title="Permanent link">&para;</a></h2>
<p>A labor során az alábbi feladatokat a laborvezető segítségével, illetve a jelölt feladatokat önállóan kell megvalósítani.</p>
<ol>
<li>Város lista megvalósítása: 1 pont</li>
<li>Időjárás nézet létrehozása és bekötése a navigációba: 2 pont</li>
<li>Hálózati kommunikáció megvalósítása: 1 pont</li>
<li>Önálló feladat: város listából törlés megvalósítása: 1 pont</li>
</ol>
<p>A labor során egy komplex időjárás alkalmazás készül el. A labor szűkös időkerete miatt szükség lesz nagyobb kódblokkok másolására, azonban minden esetben figyeljünk a laborvezető magyarázatára, hogy a kódrészek érthetőek legyenek. A cél a bemutatott kódok megértése és a felhasznált libraryk használatának elsajátítása.</p>
<p><em>Elnézést kérünk  az eddigieknél nagyobb kód blokkokért, de egy ilyen, bemutató jellegű feladat kisebb méretben nem oldható meg, illetve a labor elveszítené a lényegét, ha csak egy „hello world” hálózati kommunikációs lekérést valósítanánk meg. Köszönjük a megértést.</em></p>
<h2 id="elokeszuletek">Előkészületek<a class="headerlink" href="#elokeszuletek" title="Permanent link">&para;</a></h2>
<p>A feladatok megoldása során ne felejtsd el követni a <a href="../../tudnivalok/github/GitHub/">feladat beadás folyamatát</a>.</p>
<h3 id="git-repository-letrehozasa-es-letoltese">Git repository létrehozása és letöltése<a class="headerlink" href="#git-repository-letrehozasa-es-letoltese" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Moodle-ben keresd meg a laborhoz tartozó meghívó URL-jét és annak segítségével hozd létre a saját repository-dat.</p>
</li>
<li>
<p>Várd meg, míg elkészül a repository, majd checkout-old ki.</p>
<div class="admonition tip">
<p>Egyetemi laborokban, ha a checkout során nem kér a rendszer felhasználónevet és jelszót, és nem sikerül a checkout, akkor valószínűleg a gépen korábban megjegyzett felhasználónévvel próbálkozott a rendszer. Először töröld ki a mentett belépési adatokat (lásd <a href="../../tudnivalok/github/GitHub-credentials/">itt</a>), és próbáld újra.</p>
</div>
</li>
<li>
<p>Hozz létre egy új ágat <code>megoldas</code> néven, és ezen az ágon dolgozz.</p>
</li>
<li>
<p>A <code>neptun.txt</code> fájlba írd bele a Neptun kódodat. A fájlban semmi más ne szerepeljen, csak egyetlen sorban a Neptun kód 6 karaktere.</p>
</li>
</ol>
<h3 id="projekt-letrehozasa">Projekt létrehozása<a class="headerlink" href="#projekt-letrehozasa" title="Permanent link">&para;</a></h3>
<p>Első lépésként indítsuk el az Android Studio-t, majd:<br />
1. Hozzunk létre egy új projektet, válasszuk az <em>Empty Activity</em> lehetőséget.<br />
2. A projekt neve legyen <code>WeatherInfo</code>, a kezdő package pedig <code>hu.bme.aut.android.weatherinfo</code><br />
3. Nyelvnek válasszuk a <em>Kotlin</em>-t.
4. A minimum API szint legyen <strong>API24: Android 7.0.</strong>
5. A <em>Build configuration language</em> Kotlin DSL legyen.</p>
<div class="admonition danger">
<p class="admonition-title">FILE PATH</p>
<p>A projekt a repository-ban lévő WeatherInfo könyvtárba kerüljön, és beadásnál legyen is felpusholva! A kód nélkül nem tudunk maximális pontot adni a laborra!</p>
</div>
<h3 id="fuggosegek-felvetele">Függőségek felvétele<a class="headerlink" href="#fuggosegek-felvetele" title="Permanent link">&para;</a></h3>
<p>Vegyük fel a szükséges könyvtárakat a <code>libs.versions.toml</code> fájlban:
<div class="highlight"><pre><span></span><code><span class="k">[versions]</span>
<span class="n">coilCompose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2.6.0&quot;</span>
<span class="n">moshi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1.15.1&quot;</span>
<span class="n">retrofit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2.11.0&quot;</span>
<span class="n">navigationCompose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2.8.2&quot;</span>

<span class="k">[libraries]</span>
<span class="n">androidx-navigation-compose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;androidx.navigation&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s">&quot;navigation-compose&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">.</span><span class="n">ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;navigationCompose&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="n">coil-compose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;io.coil-kt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s">&quot;coil-compose&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">.</span><span class="n">ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;coilCompose&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="n">squareup-moshi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;com.squareup.moshi&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;moshi-kotlin&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">.</span><span class="n">ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;moshi&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="n">converter-moshi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;com.squareup.retrofit2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;converter-moshi&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">.</span><span class="n">ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;retrofit&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="n">retrofit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;com.squareup.retrofit2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;retrofit&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">.</span><span class="n">ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;retrofit&quot;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div></p>
<p>Majd az <em>app</em> modulhoz tartozó <code>build.gradle</code> fájlban a <code>dependencies</code> blokkhoz adjuk hozzá az alábbiakat:</p>
<div class="highlight"><pre><span></span><code><span class="n">dependencies</span><span class="p">{</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="n">libs</span><span class="p">.</span><span class="na">androidx</span><span class="p">.</span><span class="na">navigation</span><span class="p">.</span><span class="na">compose</span><span class="p">)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="n">libs</span><span class="p">.</span><span class="na">retrofit</span><span class="p">)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="n">libs</span><span class="p">.</span><span class="na">squareup</span><span class="p">.</span><span class="na">moshi</span><span class="p">)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="n">libs</span><span class="p">.</span><span class="na">converter</span><span class="p">.</span><span class="na">moshi</span><span class="p">)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="n">libs</span><span class="p">.</span><span class="na">coil</span><span class="p">.</span><span class="na">compose</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Ezután kattintsunk a jobb felső sarokban megjelenő <strong>Sync now</strong> gombra.</p>
<div class="admonition info">
<p class="admonition-title">Retrofit</p>
<p>A <code>Retrofit</code> a fejlesztő által leírt egyszerű, megfelelően annotált interfészek alapján kódgenerálással állít elő HTTP hivásokat lebonyolító implementációt. Kezeli az URL-ben inline módon adott paramétereket, az URL queryket, stb. Támogatja a legnépszerűbb szerializáló/deszerializáló megoldásokat is (pl.: <a href="https://github.com/google/gson"><code>Gson</code></a>, <a href="https://github.com/square/moshi"><code>Moshi</code></a>, <a href="https://sourceforge.net/projects/simple/"><code>Simple XML</code></a>, stb.), amikkel Java/Kotlin objektumok, és JSON vagy XML formátumú adatok közötti kétirányú átalakítás valósítható meg. A laboron ezek közül a <code>Moshi</code>-t fogjuk használni a JSON-ban érkező időjárás adatok konvertálására.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Coil</p>
<p>A <code>Coil</code>  egy hatékony képbetöltést és cache-elést megvalósító library Androidra. Egyszerű <em>interface</em>-e és hatékonysága miatt használjuk.</p>
</div>
<h3 id="engedelyek-felvetele">Engedélyek felvétele<a class="headerlink" href="#engedelyek-felvetele" title="Permanent link">&para;</a></h3>
<p>Az alkalmazásban szükségünk lesz internet elérésre. Vegyük fel az <code>AndroidManifest.xml</code> állományban az <em>Internet permission</em>-t az <code>application</code> tagen <em>kívülre</em>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.permission.INTERNET&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Engedélyek</p>
<p>Androidon API 23-tól (6.0, Marshmallow) az engedélyek két csoportba lettek osztva. A <em>normal</em> csoportba tartozó engedélyeket elég felvenni az <code>AndroidManifest.xml</code> fájlba az előbb látott módon és az alkalmazás automatikusan megkapja őket. A <em>dangerous</em> csoportba tartozó engedélyek esetén ez már nem elég, futás időben explicit módon el kell kérni őket a felhasználótól, aki akármikor meg is tagadhatja az alkalmazástól a kért engedélyt. Az engedélyek kezeléséről bővebben a <a href="https://developer.android.com/guide/topics/permissions/overview">developer.android.com</a> oldalon lehet tájékozódni.</p>
</div>
<h3 id="eroforrasok-hozzaadasa">Erőforrások hozzáadása<a class="headerlink" href="#eroforrasok-hozzaadasa" title="Permanent link">&para;</a></h3>
<p>Töltsük le az alkalmazásban használt képeket tartalmazó <a href="downloads/res.zip">tömörített fájlt</a>, majd helyezzük el a tartalmát a projektünk <em>res</em> mappájába.</p>
<p>Vegyük fel az alábbi szöveges erőforrásokat a <code>res/values/strings.xml</code>-be:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;resources&gt;</span>
<span class="w">    </span><span class="nt">&lt;string</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;app_name&quot;</span><span class="nt">&gt;</span>WeatherInfo<span class="nt">&lt;/string&gt;</span>
<span class="w">    </span><span class="nt">&lt;string</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;new_city&quot;</span><span class="nt">&gt;</span>New<span class="w"> </span>city<span class="nt">&lt;/string&gt;</span>
<span class="w">    </span><span class="nt">&lt;string</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ok&quot;</span><span class="nt">&gt;</span>OK<span class="nt">&lt;/string&gt;</span>
<span class="w">    </span><span class="nt">&lt;string</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;cancel&quot;</span><span class="nt">&gt;</span>Cancel<span class="nt">&lt;/string&gt;</span>
<span class="w">    </span><span class="nt">&lt;string</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;weather_in&quot;</span><span class="nt">&gt;</span>Weather<span class="w"> </span>in<span class="w"> </span>%1$s<span class="nt">&lt;/string&gt;</span>
<span class="w">    </span><span class="nt">&lt;string</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;some_error_message&quot;</span><span class="nt">&gt;</span>Something<span class="w"> </span>went<span class="w"> </span>wrong.<span class="nt">&lt;/string&gt;</span>
<span class="w">    </span><span class="nt">&lt;string</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label_temperature&quot;</span><span class="nt">&gt;</span>Temperature<span class="nt">&lt;/string&gt;</span>
<span class="w">    </span><span class="nt">&lt;string</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label_min_temperature&quot;</span><span class="nt">&gt;</span>Min.<span class="w"> </span>temperature<span class="nt">&lt;/string&gt;</span>
<span class="w">    </span><span class="nt">&lt;string</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label_max_temperature&quot;</span><span class="nt">&gt;</span>Max.<span class="w"> </span>temperature<span class="nt">&lt;/string&gt;</span>
<span class="w">    </span><span class="nt">&lt;string</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label_pressure&quot;</span><span class="nt">&gt;</span>Pressure<span class="nt">&lt;/string&gt;</span>
<span class="w">    </span><span class="nt">&lt;string</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label_humidity&quot;</span><span class="nt">&gt;</span>Humidity<span class="nt">&lt;/string&gt;</span>
<span class="w">    </span><span class="nt">&lt;string</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;new_city_hint&quot;</span><span class="nt">&gt;</span>City<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/resources&gt;</span>
</code></pre></div>
<h3 id="openweathermap-api-kulcs">OpenWeatherMap API kulcs<a class="headerlink" href="#openweathermap-api-kulcs" title="Permanent link">&para;</a></h3>
<p>Regisztráljunk saját felhasználót az <a href="https://openweathermap.org/">OpenWeatherMap</a> oldalon, és hozzunk létre egy API kulcsot, aminek a segítségével használhatjuk majd a szolgáltatást az alkalmazásunkban! </p>
<ol>
<li>Kattintsunk a <em>Sign in</em> majd a <em>Create an account</em> gombra.</li>
<li>Töltsük ki a regisztrációs formot</li>
<li>A <em>Company</em> mező értéke legyen "BME", a <em>Purpose</em> értéke legyen "Education/Science"</li>
<li>Sikeres regisztráció után az <em>API keys</em> tabon található az alapértelmezettként létrehozott API kulcs.</li>
</ol>
<p>A kapott API kulcsra később szükségünk lesz az időjárás adatokat lekérő API hívásnál.</p>
<h2 id="varoslista-megvalositasa-1-pont">Városlista megvalósítása (1 pont)<a class="headerlink" href="#varoslista-megvalositasa-1-pont" title="Permanent link">&para;</a></h2>
<p>Valósítsuk meg az egy <code>LazyColumn</code>-ból álló, városok listáját megjelenítő <code>CityListScreen</code>-t!</p>
<p>A város nevére kattintva jelenik majd meg az időjárás nézet (<em>WeatherScreen</em>), ahol az időjárás információk letöltése fog történni. Új város felvételére egy <em>FloatingActionButton</em> fog szolgálni.</p>
<h3 id="az-architektura-kialakitasa">Az architektúra kialakítása<a class="headerlink" href="#az-architektura-kialakitasa" title="Permanent link">&para;</a></h3>
<p>Az adatok forrása az előző laboron látottakhoz hasonlóan egy <em>repository</em> lesz. Innen fogjuk visszakapni a (jelenleg csak a memóriában tárolt) várokainkat.</p>
<h4 id="a-modell-osztaly">A modell osztály<a class="headerlink" href="#a-modell-osztaly" title="Permanent link">&para;</a></h4>
<p>Vegyünk fel a fő <em>package</em>-ünkbe egy <code>data</code>, majd ezen belül egy <code>local</code>, majd ezen belül egy <code>model</code> <em>package</em>-et. Ide fog kerülni a városainkat reprezentáló osztály, ami jelen esetben csupán egy <em>id</em>-val és egy <em>névvel</em> rendelkezik.</p>
<p><code>City.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.local.model</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">City</span><span class="p">(</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>
</code></pre></div>
<h4 id="a-repository">A repository<a class="headerlink" href="#a-repository" title="Permanent link">&para;</a></h4>
<p>Ez után már elkészíthetjük a <em>repository</em>-jainkat a már látott módon a <code>hu.bme.aut.android.weatherinfo.data.local.repository</code> <em>package</em>-ben.</p>
<p><code>ICityRepository.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.local.repository</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.local.model.City</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.Flow</span>

<span class="kd">interface</span><span class="w"> </span><span class="nc">ICityRepository</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getAllCities</span><span class="p">():</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">City</span><span class="o">&gt;&gt;</span>
<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">addCityByName</span><span class="p">(</span><span class="n">cityName</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p><code>MemoryCityRepository.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.local.repository</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.mutableStateListOf</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.local.model.City</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.Flow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.flow</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">MemoryCityRepository</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ICityRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">nextId</span><span class="o">=</span><span class="m">3</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">cities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mutableStateListOf</span><span class="p">(</span>
<span class="w">        </span><span class="n">City</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Budapest&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="n">City</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;London&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="n">City</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Berlin&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getAllCities</span><span class="p">():</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">City</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">flow</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">emit</span><span class="p">(</span><span class="n">cities</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">addCityByName</span><span class="p">(</span><span class="n">cityName</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">cities</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">City</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nextId</span><span class="o">++</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cityName</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<p>A <em>repository</em> elkészítése után példányosítsuk is azt az <em>application</em> osztályunkban a <code>hu.bme.aut.android.weatherinfo</code> <em>package</em>-ben.</p>
<p><code>WeatherInfo.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo</span>

<span class="k">import</span><span class="w"> </span><span class="nn">android.app.Application</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.local.repository.ICityRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.local.repository.MemoryCityRepository</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">WeatherInfoApplication</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Application</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>

<span class="w">        </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">cityRepository</span><span class="p">:</span><span class="w"> </span><span class="n">ICityRepository</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">()</span>

<span class="w">        </span><span class="n">cityRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MemoryCityRepository</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Majd pedig az <code>AndroidManifest.xml</code>-ben állítsuk be az <em>application</em> osztályunk használatát.</p>
<p><code>AndroidManifest.xml</code>:</p>
<div class="highlight"><pre><span></span><code>...
<span class="nt">&lt;application</span>
<span class="w">        </span><span class="na">android:name=</span><span class="s">&quot;.WeatherInfoApplication&quot;</span>
<span class="err">...</span>
</code></pre></div>
<h4 id="a-viewmodel">A ViewModel<a class="headerlink" href="#a-viewmodel" title="Permanent link">&para;</a></h4>
<p>Miután a <em>repository</em>-val megvagyunk, folytathatjuk a következő réteggel, a <em>viewmodel</em>-lel. A városlistához tartozó <em>viewmodel</em>-t és <em>screen</em>-t a <code>hu.bme.aut.android.weatherinfo.feature.citylist</code> <em>package</em>-ben fogjuk elkészíteni. Hozzunk tehát létre itt egy új <em>package</em>-et az állapotnak <code>state</code> néven, majd helyezzük is el benne a <code>CityListState</code>-et.</p>
<p><code>CityListState.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.citylist.state</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.local.model.City</span>


<span class="kd">sealed</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">CityListState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="nc">Loading</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">CityListState</span><span class="p">()</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Error</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">error</span><span class="p">:</span><span class="w"> </span><span class="n">Throwable</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">CityListState</span><span class="p">()</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Result</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">cityList</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">City</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">CityListState</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>Ezek után a <code>citylist</code> <em>package</em>-be jöhet a <em>viewmodel</em>:</p>
<p><code>CityListViewModel.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.citylist</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.ViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.ViewModelProvider</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.viewModelScope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.viewmodel.initializer</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.viewmodel.viewModelFactory</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.WeatherInfoApplication</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.local.model.City</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.local.repository.ICityRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.citylist.state.CityListState</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.MutableStateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.asStateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.collectLatest</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.launch</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">CityListViewModel</span><span class="p">(</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">cityRepository</span><span class="p">:</span><span class="w"> </span><span class="n">ICityRepository</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ViewModel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MutableStateFlow</span><span class="o">&lt;</span><span class="n">CityListState</span><span class="o">&gt;</span><span class="p">(</span><span class="n">CityListState</span><span class="p">.</span><span class="na">Loading</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_state</span><span class="p">.</span><span class="na">asStateFlow</span><span class="p">()</span>

<span class="w">    </span><span class="k">init</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">getAllCities</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getAllCities</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CityListState</span><span class="p">.</span><span class="na">Loading</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">cityRepository</span><span class="p">.</span><span class="na">getAllCities</span><span class="p">().</span><span class="na">collectLatest</span><span class="p">{</span>
<span class="w">                    </span><span class="n">_state</span><span class="p">.</span><span class="na">tryEmit</span><span class="p">(</span><span class="n">CityListState</span><span class="p">.</span><span class="na">Result</span><span class="p">(</span><span class="nb">it</span><span class="p">))</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CityListState</span><span class="p">.</span><span class="na">Error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">addCity</span><span class="p">(</span><span class="n">city</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">cityRepository</span><span class="p">.</span><span class="na">addCityByName</span><span class="p">(</span><span class="n">city</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">Factory</span><span class="p">:</span><span class="w"> </span><span class="n">ViewModelProvider</span><span class="p">.</span><span class="na">Factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewModelFactory</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">initializer</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">CityListViewModel</span><span class="p">(</span>
<span class="w">                    </span><span class="n">cityRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WeatherInfoApplication</span><span class="p">.</span><span class="na">cityRepository</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="a-varoslista-kepernyo-megvalositasa">A városlista képernyő megvalósítása<a class="headerlink" href="#a-varoslista-kepernyo-megvalositasa" title="Permanent link">&para;</a></h3>
<p>Immáron a város adataink készen állnak arra, hogy megjelenítsük azokat a felületen. A <code>CityListScreen</code> elkészítése előtt azonban először az azt alkotó komponenseket készítsük el.</p>
<h4 id="a-komponensek-elkeszitese">A komponensek elkészítése<a class="headerlink" href="#a-komponensek-elkeszitese" title="Permanent link">&para;</a></h4>
<p>A városainkat egy <em>kártyán</em> fogjuk megjeleníteni, aminek van egy ikonja, ami egyelőre csak egy <em>placeholder</em>, egy felirata, valamint egy <code>SwipeToDismissBox</code> segítségével megvalósítja azt, hogy ha balra húzzuk, akkor törlődik. Készítsük el ezt a komponenst a <code>hu.bme.aut.android.weatherinfo.feature.citylist.components</code> <em>package</em>-ben.</p>
<p><code>CityCard.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.citylist.components</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.background</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.clickable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Arrangement</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Row</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxSize</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxWidth</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.padding</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.size</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.shape.RoundedCornerShape</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.Icons</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.Delete</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.ExperimentalMaterial3Api</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.Icon</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.ListItem</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.ListItemDefaults</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.MaterialTheme</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.OutlinedCard</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.SwipeToDismissBox</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.SwipeToDismissBoxValue</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.Text</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.rememberSwipeToDismissBoxState</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Alignment</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.graphics.Color</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.res.painterResource</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.tooling.preview.Preview</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.dp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.sp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.R</span>

<span class="nd">@OptIn</span><span class="p">(</span><span class="n">ExperimentalMaterial3Api</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">CityCard</span><span class="p">(</span>
<span class="w">    </span><span class="n">city</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">onCityClick</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">,</span>
<span class="w">    </span><span class="n">onDelete</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">dismissState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rememberSwipeToDismissBoxState</span><span class="p">(</span><span class="n">confirmValueChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">it</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SwipeToDismissBoxValue</span><span class="p">.</span><span class="na">EndToStart</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">onDelete</span><span class="p">(</span><span class="n">city</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="nd">@rememberSwipeToDismissBoxState</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">        </span><span class="c1">// positional threshold of 25%</span>
<span class="w">        </span><span class="n">positionalThreshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">.</span><span class="m">25f</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="n">OutlinedCard</span><span class="p">(</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">            </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">(),</span>
<span class="w">        </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">16.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SwipeToDismissBox</span><span class="p">(</span>
<span class="w">            </span><span class="n">enableDismissFromStartToEnd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dismissState</span><span class="p">,</span>
<span class="w">            </span><span class="n">backgroundContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Row</span><span class="p">(</span>
<span class="w">                    </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                        </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<span class="w">                        </span><span class="p">.</span><span class="na">background</span><span class="p">(</span>
<span class="w">                            </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">dismissState</span><span class="p">.</span><span class="na">dismissDirection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                </span><span class="n">SwipeToDismissBoxValue</span><span class="p">.</span><span class="na">EndToStart</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="na">Red</span>
<span class="w">                                </span><span class="k">else</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colorScheme</span><span class="p">.</span><span class="na">background</span>
<span class="w">                            </span><span class="p">}</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">12.</span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">                    </span><span class="n">verticalAlignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">.</span><span class="na">CenterVertically</span><span class="p">,</span>
<span class="w">                    </span><span class="n">horizontalArrangement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrangement</span><span class="p">.</span><span class="na">End</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Icon</span><span class="p">(</span>
<span class="w">                        </span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Delete</span><span class="p">,</span>
<span class="w">                        </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Delete&quot;</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ListItem</span><span class="p">(</span>
<span class="w">                </span><span class="n">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ListItemDefaults</span><span class="p">.</span><span class="na">colors</span><span class="p">(</span><span class="n">containerColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colorScheme</span><span class="p">.</span><span class="na">primaryContainer</span><span class="p">),</span>
<span class="w">                </span><span class="n">headlineContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Text</span><span class="p">(</span>
<span class="w">                        </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">city</span><span class="p">,</span>
<span class="w">                        </span><span class="n">fontSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24.</span><span class="n">sp</span>
<span class="w">                    </span><span class="p">)</span>

<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">leadingContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Icon</span><span class="p">(</span>
<span class="w">                        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                            </span><span class="p">.</span><span class="na">size</span><span class="p">(</span><span class="m">64.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">                        </span><span class="n">painter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">painterResource</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">drawable</span><span class="p">.</span><span class="na">ic_placeholder</span><span class="p">),</span>
<span class="w">                        </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">clickable</span><span class="p">(</span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">onCityClick</span><span class="p">(</span>
<span class="w">                        </span><span class="n">city</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@Composable</span>
<span class="nd">@Preview</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">CityCardPreview</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">CityCard</span><span class="p">(</span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Budapest&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">onCityClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="n">onDelete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span>
<span class="p">}</span>
</code></pre></div>
<p>A megjelenítéshez most nem készítettünk saját komplex elrendezést, inkább a beépített <code>ListItem</code> <em>composable</em>-t használjuk. A nekünk kellő funkcionalitást, hogy kiírunk egy szöveget, és felhelyezünk egy képet, könnyen megtehetjük a <em>headlineContent</em> és a <em>leadingContent</em> <em>property</em>-kkel.</p>
<p>Figyeljük meg, hogy a <code>SwipeToDismissBox</code>-nál hogyan tiltjuk le a balra húzást, és hogyan állítjuk be az állapotát!</p>
<p>A város lista kiírása után már csak annyi dolgunk van, hogy lehetővé tegyük új város felvételét is. Ezt egy egyszerű általános dialógussal fogjuk megtenni, amibe a felhasználó egy szöveget írhat be.</p>
<p><code>StringInputDialog.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.citylist.components</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.background</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Arrangement</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Column</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Row</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Spacer</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxWidth</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.height</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.padding</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.shape.RoundedCornerShape</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.text.KeyboardOptions</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.Button</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.Card</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.MaterialTheme</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.OutlinedButton</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.OutlinedTextField</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.Text</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.getValue</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.mutableStateOf</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.remember</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.setValue</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Alignment</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.res.stringResource</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.text.font.FontWeight</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.text.input.ImeAction</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.tooling.preview.Preview</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.dp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.sp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.window.Dialog</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.R</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">StringInputDialog</span><span class="p">(</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">,</span>
<span class="w">    </span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">label</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">onDismiss</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">,</span>
<span class="w">    </span><span class="n">onConfirm</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Dialog</span><span class="p">(</span><span class="n">onDismissRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">onDismiss</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Card</span><span class="p">(</span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">16.</span><span class="n">dp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Column</span><span class="p">(</span>
<span class="w">                </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span>
<span class="w">                    </span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">background</span><span class="p">(</span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colorScheme</span><span class="p">.</span><span class="na">background</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">16.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">                </span><span class="n">horizontalAlignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">.</span><span class="na">CenterHorizontally</span><span class="p">,</span>
<span class="w">                </span><span class="n">verticalArrangement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrangement</span><span class="p">.</span><span class="na">Center</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Text</span><span class="p">(</span>
<span class="w">                    </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">title</span><span class="p">,</span>
<span class="w">                    </span><span class="n">fontWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FontWeight</span><span class="p">.</span><span class="na">Bold</span><span class="p">,</span>
<span class="w">                    </span><span class="n">fontSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24.</span><span class="n">sp</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">                </span><span class="n">Spacer</span><span class="p">(</span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">height</span><span class="p">(</span><span class="m">16.</span><span class="n">dp</span><span class="p">))</span>
<span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="nv">input</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">remember</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">mutableStateOf</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="nv">isInputError</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">remember</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">mutableStateOf</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="n">OutlinedTextField</span><span class="p">(</span>
<span class="w">                    </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">                    </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">,</span>
<span class="w">                    </span><span class="n">onValueChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">it</span>
<span class="w">                        </span><span class="n">isInputError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">()</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="n">maxLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span>
<span class="w">                    </span><span class="n">isError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isInputError</span><span class="p">,</span>
<span class="w">                    </span><span class="n">keyboardOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyboardOptions</span><span class="p">(</span><span class="n">imeAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImeAction</span><span class="p">.</span><span class="na">Done</span><span class="p">),</span>
<span class="w">                    </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">label</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">                </span><span class="n">Spacer</span><span class="p">(</span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">height</span><span class="p">(</span><span class="m">16.</span><span class="n">dp</span><span class="p">))</span>
<span class="w">                </span><span class="n">Row</span><span class="p">(</span>
<span class="w">                    </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">(),</span>
<span class="w">                    </span><span class="n">horizontalArrangement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrangement</span><span class="p">.</span><span class="na">SpaceEvenly</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">OutlinedButton</span><span class="p">(</span>
<span class="w">                        </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">onDismiss</span><span class="p">,</span>
<span class="w">                        </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">                        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span>
<span class="w">                            </span><span class="p">.</span><span class="na">weight</span><span class="p">(</span><span class="m">1f</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">Text</span><span class="p">(</span><span class="n">stringResource</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">cancel</span><span class="p">))</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="n">Button</span><span class="p">(</span>
<span class="w">                        </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isInputError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                </span><span class="n">onConfirm</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="w">                                </span><span class="n">onDismiss</span><span class="p">()</span>
<span class="w">                            </span><span class="p">}</span>
<span class="w">                        </span><span class="p">},</span>
<span class="w">                        </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">                        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span>
<span class="w">                            </span><span class="p">.</span><span class="na">weight</span><span class="p">(</span><span class="m">1f</span><span class="p">)</span>
<span class="w">                            </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">Text</span><span class="p">(</span><span class="n">stringResource</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">ok</span><span class="p">))</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@Composable</span>
<span class="nd">@Preview</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">StringInputDialogPreview</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">StringInputDialog</span><span class="p">(</span>
<span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;New City&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;City name&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">onDismiss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{},</span>
<span class="w">        </span><span class="n">onConfirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Ennek a függvénynek két lambda paramétere lesz, <code>onDismiss</code> ez fog felelni azért hogy a dialógus ablakunkat el tudjuk tüntetni, illetve az <code>onConfirm</code>, ami pedig az új város hozzáadását teszi lehetővé. Ezeket a lambda paramétereket továbbadjuk paraméterként a többi függvénynek a következő képpen.</p>
<ul>
<li><code>onDismiss</code> - Ezt a paramétert mind a két gomb meg kell hogy kapja, ugyanis ha hozzáadtunk egy új várost azt szeretnénk hogy eltűnjön az ablak, illetve ha meggondolnánk magunkat és nem szeretnénk új várost felvenni akkor is el kell tüntetni az ablakot.</li>
<li><code>onConfirm</code> - Ezt csak a pozitív gombra fogjuk rátenni, egy <em>string</em> paraméterrel, ami pedig a beviteli mező szerint lesz változtatható.</li>
</ul>
<h4 id="a-citylistscreen-elkeszitese">A CityListScreen elkészítése<a class="headerlink" href="#a-citylistscreen-elkeszitese" title="Permanent link">&para;</a></h4>
<p>Miután elkészültönk a <em>viewmodel</em>-lel és a komponensekkel is, nincs más hátra, minthogy összerakjuk a <code>CityListScreen</code>-t a <code>hu.bme.aut.android.weatherinfo.feature.citylist</code> <em>package</em>-ben.</p>
<p><code>CityListScreen.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.citylist</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Spacer</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.height</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.padding</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.lazy.LazyColumn</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.lazy.items</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.Icons</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.filled.Add</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.CircularProgressIndicator</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.ExperimentalMaterial3Api</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.Icon</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.LargeFloatingActionButton</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.MaterialTheme</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.Scaffold</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.Text</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.TopAppBar</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.TopAppBarDefaults</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.getValue</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.mutableStateOf</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.remember</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.setValue</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.res.stringResource</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.tooling.preview.Preview</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.dp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.compose.collectAsStateWithLifecycle</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.viewmodel.compose.viewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.R</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.citylist.components.CityCard</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.citylist.components.StringInputDialog</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.citylist.state.CityListState</span>

<span class="nd">@OptIn</span><span class="p">(</span><span class="n">ExperimentalMaterial3Api</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">CityListScreen</span><span class="p">(</span>
<span class="w">    </span><span class="n">onCityClick</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">,</span>
<span class="w">    </span><span class="n">viewModel</span><span class="p">:</span><span class="w"> </span><span class="n">CityListViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewModel</span><span class="p">(</span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CityListViewModel</span><span class="p">.</span><span class="na">Factory</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">state</span><span class="p">.</span><span class="na">collectAsStateWithLifecycle</span><span class="p">().</span><span class="na">value</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">isNewCityDialogOpen</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">remember</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">mutableStateOf</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="n">Scaffold</span><span class="p">(</span>
<span class="w">        </span><span class="n">topBar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">TopAppBar</span><span class="p">(</span>
<span class="w">                </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">app_name</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">                </span><span class="n">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TopAppBarDefaults</span><span class="p">.</span><span class="na">topAppBarColors</span><span class="p">(</span>
<span class="w">                    </span><span class="n">containerColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colorScheme</span><span class="p">.</span><span class="na">primary</span><span class="p">,</span>
<span class="w">                    </span><span class="n">titleContentColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colorScheme</span><span class="p">.</span><span class="na">onPrimary</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="n">floatingActionButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">LargeFloatingActionButton</span><span class="p">(</span>
<span class="w">                </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">isNewCityDialogOpen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">containerColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colorScheme</span><span class="p">.</span><span class="na">primary</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Icon</span><span class="p">(</span>
<span class="w">                    </span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Add</span><span class="p">,</span>
<span class="w">                    </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">innerPadding</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">CityListState</span><span class="p">.</span><span class="na">Loading</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">CircularProgressIndicator</span><span class="p">()</span>
<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">CityListState</span><span class="p">.</span><span class="na">Error</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">error</span><span class="p">.</span><span class="na">toString</span><span class="p">())</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">CityListState</span><span class="p">.</span><span class="na">Result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">LazyColumn</span><span class="p">(</span>
<span class="w">                    </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                        </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="n">innerPadding</span><span class="p">)</span>
<span class="w">                        </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">items</span><span class="p">(</span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">cityList</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                        </span><span class="n">CityCard</span><span class="p">(</span>
<span class="w">                            </span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">city</span><span class="p">.</span><span class="na">name</span><span class="p">,</span>
<span class="w">                            </span><span class="n">onCityClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">onCityClick</span><span class="p">,</span>
<span class="w">                            </span><span class="n">onDelete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/*TODO remove city*/</span><span class="w"> </span><span class="p">}</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">cityList</span><span class="p">.</span><span class="na">size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">cityList</span><span class="p">.</span><span class="na">indexOf</span><span class="p">(</span><span class="n">city</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="n">Spacer</span><span class="p">(</span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">height</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">))</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>


<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isNewCityDialogOpen</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="n">StringInputDialog</span><span class="p">(</span>
<span class="w">                </span><span class="n">onDismiss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">isNewCityDialogOpen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">},</span>
<span class="w">                </span><span class="n">onConfirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cityList</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                    </span><span class="n">viewModel</span><span class="p">.</span><span class="na">addCity</span><span class="p">(</span><span class="n">cityList</span><span class="p">)</span>
<span class="w">                    </span><span class="n">isNewCityDialogOpen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">new_city</span><span class="p">),</span>
<span class="w">                </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">new_city_hint</span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@Composable</span>
<span class="nd">@Preview</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">CityListScreenPreview</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">CityListScreen</span><span class="p">(</span><span class="n">onCityClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="a-navigacio-elkeszitese">A navigáció elkészítése<a class="headerlink" href="#a-navigacio-elkeszitese" title="Permanent link">&para;</a></h3>
<p>A szokásoknak megfelelően, a navigációhoz <code>NavGraph</code>-ot fogunk használni. Készítsük tehát el a <code>hu.bme.aut.android.weatherinfo.navigation</code> <em>package</em>-ben a szükséges osztályokat.</p>
<p><code>Screen.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.navigation</span>

<span class="kd">sealed</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Screen</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">route</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">CityListScreen</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Screen</span><span class="p">(</span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;city_list&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p><code>NavGraph.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.navigation</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.NavHostController</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.NavType</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.compose.NavHost</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.compose.composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.compose.rememberNavController</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.citylist.CityListScreen</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">NavGraph</span><span class="p">(</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">,</span>
<span class="w">    </span><span class="n">navController</span><span class="p">:</span><span class="w"> </span><span class="n">NavHostController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rememberNavController</span><span class="p">(),</span>
<span class="w">    </span><span class="n">startDestination</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Screen</span><span class="p">.</span><span class="na">CityListScreen</span><span class="p">.</span><span class="na">route</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">NavHost</span><span class="p">(</span>
<span class="w">        </span><span class="n">navController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">navController</span><span class="p">,</span>
<span class="w">        </span><span class="n">startDestination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startDestination</span><span class="p">,</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">composable</span><span class="p">(</span><span class="n">Screen</span><span class="p">.</span><span class="na">CityListScreen</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">CityListScreen</span><span class="p">(</span>
<span class="w">                </span><span class="n">onCityClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/*TODO navigation*/</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Végül tegyük fel a <code>MainActivity</code>-re a <code>NavGraph</code>-unkat.</p>
<p><code>MainActivity.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo</span>

<span class="k">import</span><span class="w"> </span><span class="nn">android.os.Bundle</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.activity.ComponentActivity</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.activity.compose.setContent</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.activity.enableEdgeToEdge</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.navigation.NavGraph</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.ui.theme.WeatherInfoTheme</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">MainActivity</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ComponentActivity</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span><span class="w"> </span><span class="n">Bundle?)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
<span class="w">        </span><span class="n">enableEdgeToEdge</span><span class="p">()</span>
<span class="w">        </span><span class="n">setContent</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">WeatherInfoTheme</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">NavGraph</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Ezen a ponton már megjelenik a város lista, és fel is tudunk venni bele új elemet.</p>
<p>Próbáljuk ki az alkalmazást!</p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts egy <strong>képernyőképet</strong>, amelyen látszik a <strong>városnevek listája egy újonnan hozzáadott várossal amelynek a neve a NEPTUN kódod</strong> (emulátoron, készüléket tükrözve vagy képernyőfelvétellel), a <strong>NewCityDialog</strong> kódja, valamint a <strong>neptun kódod a kódban valahol kommentként</strong>! A képet a megoldásban a repository-ba f1.png néven töltsd föl!</p>
<p>A képernyőkép szükséges feltétele a pontszám megszerzésének.</p>
</div>
<h2 id="az-idojaras-nezet-letrehozasa-es-bekotese-a-navigacioba-2-pont">Az időjárás nézet létrehozása és bekötése a navigációba (2 pont)<a class="headerlink" href="#az-idojaras-nezet-letrehozasa-es-bekotese-a-navigacioba-2-pont" title="Permanent link">&para;</a></h2>
<h3 id="az-architektura-kialakitasa_1">Az architektúra kialakítása<a class="headerlink" href="#az-architektura-kialakitasa_1" title="Permanent link">&para;</a></h3>
<p>Az adataink áramlása hasonló lesz a már korábban látottakhoz, (<em>repository</em> -&gt; <em>viewmodel</em> -&gt; <em>screen</em>) szóval készítsük is el ezeket.</p>
<h4 id="modell-osztalyok">Modell osztályok<a class="headerlink" href="#modell-osztalyok" title="Permanent link">&para;</a></h4>
<p>Az <a href="https://openweathermap.org/current">OpenWeatherMAp API</a> a kéréseinkre válaszként egy JSON objektumban fogja visszaadni az aktuális időjárást. </p>
<div class="admonition info">
<p class="admonition-title">API hívás (az {appID} lecserélendő a sajátra)</p>
<p><a href="https://api.openweathermap.org/data/2.5/weather?q=Budapest&amp;units=metric&amp;appid={appId">https://api.openweathermap.org/data/2.5/weather?q=Budapest&amp;units=metric&amp;appid={appId</a>}</p>
</div>
<details class="info">
<summary>Api válasz</summary>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;coord&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;lon&quot;</span><span class="p">:</span><span class="mf">19.0399</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;lat&quot;</span><span class="p">:</span><span class="mf">47.498</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;weather&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">741</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;main&quot;</span><span class="p">:</span><span class="s2">&quot;Fog&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;fog&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;icon&quot;</span><span class="p">:</span><span class="s2">&quot;50n&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;base&quot;</span><span class="p">:</span><span class="s2">&quot;stations&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;main&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;temp&quot;</span><span class="p">:</span><span class="mf">9.98</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;feels_like&quot;</span><span class="p">:</span><span class="mf">9.98</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;temp_min&quot;</span><span class="p">:</span><span class="mf">8.93</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;temp_max&quot;</span><span class="p">:</span><span class="mf">10.71</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;pressure&quot;</span><span class="p">:</span><span class="mi">1013</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;humidity&quot;</span><span class="p">:</span><span class="mi">96</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;sea_level&quot;</span><span class="p">:</span><span class="mi">1013</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;grnd_level&quot;</span><span class="p">:</span><span class="mi">991</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;visibility&quot;</span><span class="p">:</span><span class="mi">8000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;wind&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;speed&quot;</span><span class="p">:</span><span class="mf">1.03</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;deg&quot;</span><span class="p">:</span><span class="mi">0</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;clouds&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;all&quot;</span><span class="p">:</span><span class="mi">43</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;dt&quot;</span><span class="p">:</span><span class="mi">1728250809</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;sys&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">2009313</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;country&quot;</span><span class="p">:</span><span class="s2">&quot;HU&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;sunrise&quot;</span><span class="p">:</span><span class="mi">1728190192</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;sunset&quot;</span><span class="p">:</span><span class="mi">1728231218</span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;timezone&quot;</span><span class="p">:</span><span class="mi">7200</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">3054643</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Budapest&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;cod&quot;</span><span class="p">:</span><span class="mi">200</span>
<span class="p">}</span>
</code></pre></div>
</details>
<p>Ahhoz, hogy ebből általunk is használható objektumok legyenek, szükségünk lesz a modell osztály(ok)ra, illetve a <code>Moshi</code> könyvtárra, ami a konverziót végzi. Ebben a fázisban először a modell osztályokat készítsük el. Mint látható a kapott <em>JSON</em> elég bonyolult, és sok al csomópontot tartalmaz. Szerencsére az osztályainkat nem kell kézzel a <em>JSON</em>-ből kisilabizálni. Egyrészt a legtöbb <em>API</em>-nál kiterjedt leírást kapunk a modellről, másrészt számos konverter létezik a <em>JSON</em> -&gt; <em>Kotlin class</em> konverzióra. Mi most egy Android Studio Plugin segítségét fogjuk kérni.</p>
<p>Keressük meg az Android Studio beállításai között a <em>Plugins</em>-t, ott pedig a <em>Marketplace</em> keresőbe írjuk be, hogy <em>JSPN To Kotlin Class</em>, és telepítsük a megtalált <em>plugint</em>.</p>
<p align="center">
<img src="./assets/plugin.png" width="720">
</p>

<p>Ha ez megvan, hozzuk létra a modell osztályok <em>package</em>-ét a <code>hu.bme.aut.android.weatherinfo.data.network.model</code> helye. Ez után nyomjunk a <em>package</em>-re jobb klikket, majd <em>New</em>-&gt; <em>Kotlin data class File from JSON</em>.</p>
<p align="center">
<img src="./assets/jsontokotlin.png" width="720">
</p>

<p>A megjelenő ablakban pedig a <em>JSON Text</em> helyére illesszük be a válaszként kapott <em>JSON</em>-ünket, névnek pedig adjuk meg a <code>WeatherData</code>-t.</p>
<p>A plugin létre is hozta nekünk az összes szükséges Kotlin osztált a konverzióhoz.</p>
<details class="info">
<summary>Modell osztályok</summary>
<p><code>Cloud.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Serializable</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Clouds</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">all</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span>
<span class="p">)</span>
</code></pre></div>
<p><code>Coord.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Serializable</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Coord</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">lon</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">lat</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span>
<span class="p">)</span>
</code></pre></div>
<p><code>Main.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Serializable</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Main</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">temp</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@SerialName</span><span class="p">(</span><span class="s">&quot;feels_like&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">feels_like</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@SerialName</span><span class="p">(</span><span class="s">&quot;temp_min&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">temp_min</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>

<span class="w">    </span><span class="nd">@SerialName</span><span class="p">(</span><span class="s">&quot;temp_max&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">temp_max</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">pressure</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">humidity</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">sea_level</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">grnd_level</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span>
<span class="p">)</span>
</code></pre></div>
<p><code>Sys.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Serializable</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Sys</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">type</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">country</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">sunrise</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">sunset</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span>
<span class="p">)</span>
</code></pre></div>
<p><code>Weather.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Serializable</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Weather</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">main</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">description</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">icon</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">)</span>
</code></pre></div>
<p><code>WeatherResult.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Serializable</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">WeatherResult</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">coord</span><span class="p">:</span><span class="w"> </span><span class="n">Coord</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">weather</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Weather</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">base</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">main</span><span class="p">:</span><span class="w"> </span><span class="n">Main</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">visibility</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">wind</span><span class="p">:</span><span class="w"> </span><span class="n">Wind</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">clouds</span><span class="p">:</span><span class="w"> </span><span class="n">Clouds</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">dt</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">sys</span><span class="p">:</span><span class="w"> </span><span class="n">Sys</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">timezone</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">cod</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span>
<span class="p">)</span>
</code></pre></div>
<p><code>Wind.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Serializable</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Wind</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">speed</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">deg</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span>
<span class="p">)</span>
</code></pre></div>
</details>
<h4 id="repository">Repository<a class="headerlink" href="#repository" title="Permanent link">&para;</a></h4>
<p>Miután megvannak a modell osztályaink, elkészíthetjük a <em>repository</em>-t. A <code>hu.bme.aut.android.weatherinfo.data.network</code> csomagba készísünk egy <code>repository</code> <em>package</em>-et, majd abba egy <code>IWeatherRepository</code> <em>interface</em>-t, aminek egyetlen egy <em>getWeather()</em> függvénye lesz.</p>
<p><code>IWeatherRepository.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.network.repository</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.network.model.WeatherData</span>
<span class="k">import</span><span class="w"> </span><span class="nn">retrofit2.Call</span>

<span class="kd">interface</span><span class="w"> </span><span class="nc">IWeatherRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getWeather</span><span class="p">(</span><span class="n">city</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">):</span><span class="w"> </span><span class="n">Call</span><span class="o">&lt;</span><span class="n">WeatherData?&gt;</span><span class="o">?</span>
<span class="p">}</span>
</code></pre></div>
<p>Ezek alapján a <code>RetrofitWeatherRepository</code> (amit majd később kiegészítünk a hálózati hívással):</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.network.repository</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.network.model.WeatherData</span>
<span class="k">import</span><span class="w"> </span><span class="nn">retrofit2.Call</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">RetrofitWeatherRepository</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IWeatherRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getWeather</span><span class="p">(</span><span class="n">city</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">):</span><span class="w"> </span><span class="n">Call</span><span class="o">&lt;</span><span class="n">WeatherData?&gt;</span><span class="o">?</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>A <em>getWeather()</em> függvény visszatérési értéke egy <code>Call&lt;WeatherData&gt;</code> típusú objektum lesz. (A retrofites <em>Call</em>-t importáljuk a megjelenő lehetőségek közül.) Ez egy olyan hálózati hívást ír le, aminek a válasza <em>WeatherData</em> típusú objektummá alakítható.</p>
<p>Példányosítsuk ismét a <em>repository</em>-t az *application osztályunkban.</p>
<p><code>WeatherInfoApplication.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo</span>

<span class="k">import</span><span class="w"> </span><span class="nn">android.app.Application</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.local.repository.ICityRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.local.repository.MemoryCityRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.network.repository.IWeatherRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.network.repository.RetrofitWeatherRepository</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">WeatherInfoApplication</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Application</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>

<span class="w">        </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">weatherRepository</span><span class="p">:</span><span class="w"> </span><span class="n">IWeatherRepository</span>
<span class="w">        </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">cityRepository</span><span class="p">:</span><span class="w"> </span><span class="n">ICityRepository</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">()</span>

<span class="w">        </span><span class="n">weatherRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RetrofitWeatherRepository</span><span class="p">()</span>
<span class="w">        </span><span class="n">cityRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MemoryCityRepository</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="a-viewmodel_1">A ViewModel<a class="headerlink" href="#a-viewmodel_1" title="Permanent link">&para;</a></h4>
<p>A <em>viewmodel</em>-ünk itt is egy állapotot fog tárolni, amiben az időjárásadatok vannak megfigyelhető formában. Készítsük el tehát először ezt az állapotot a <code>hu.bme.aut.android.weatherinfo.feature.weather.state</code> <em>package</em>-ben.</p>
<p><code>WeatherState.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.weather.state</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.network.model.WeatherData</span>

<span class="kd">sealed</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">WeatherState</span><span class="p">{</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="nc">Loading</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherState</span><span class="p">()</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Error</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">error</span><span class="p">:</span><span class="w"> </span><span class="n">Throwable</span><span class="p">):</span><span class="w"> </span><span class="n">WeatherState</span><span class="p">()</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Success</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">weatherData</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherData?)</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherState</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>Most már jöhet a <em>viewmodel</em> a <code>hu.bme.aut.android.weatherinfo.feature.weather</code> csomagba.</p>
<p><code>WeatherViewModel.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.weather</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.SavedStateHandle</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.ViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.ViewModelProvider</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.createSavedStateHandle</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.viewModelScope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.viewmodel.initializer</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.viewmodel.viewModelFactory</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.WeatherInfoApplication</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.network.model.WeatherData</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.network.repository.IWeatherRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.weather.state.WeatherState</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.MutableStateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.asStateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.launch</span>
<span class="k">import</span><span class="w"> </span><span class="nn">retrofit2.Call</span>
<span class="k">import</span><span class="w"> </span><span class="nn">retrofit2.Callback</span>
<span class="k">import</span><span class="w"> </span><span class="nn">retrofit2.Response</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">WeatherViewModel</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">savedStateHandle</span><span class="p">:</span><span class="w"> </span><span class="n">SavedStateHandle</span><span class="p">,</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">weatherRepository</span><span class="p">:</span><span class="w"> </span><span class="n">IWeatherRepository</span>
<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ViewModel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MutableStateFlow</span><span class="o">&lt;</span><span class="n">WeatherState</span><span class="o">&gt;</span><span class="p">(</span><span class="n">WeatherState</span><span class="p">.</span><span class="na">Loading</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_state</span><span class="p">.</span><span class="na">asStateFlow</span><span class="p">()</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">_cityName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MutableStateFlow</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">(</span><span class="n">checkNotNull</span><span class="p">(</span><span class="n">savedStateHandle</span><span class="o">[</span><span class="s">&quot;cityName&quot;</span><span class="o">]</span><span class="p">))</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">cityName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_cityName</span><span class="p">.</span><span class="na">asStateFlow</span><span class="p">()</span>

<span class="w">    </span><span class="k">init</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">getWeather</span><span class="p">(</span><span class="n">checkNotNull</span><span class="p">(</span><span class="n">savedStateHandle</span><span class="o">[</span><span class="s">&quot;cityName&quot;</span><span class="o">]</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getWeather</span><span class="p">(</span><span class="n">cityName</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WeatherState</span><span class="p">.</span><span class="na">Loading</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">weatherRepository</span><span class="p">.</span><span class="na">getWeather</span><span class="p">(</span><span class="n">cityName</span><span class="p">)</span>
<span class="w">                    </span><span class="o">?.</span><span class="na">enqueue</span><span class="p">(</span><span class="k">object</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Callback</span><span class="o">&lt;</span><span class="n">WeatherData?&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onResponse</span><span class="p">(</span>
<span class="w">                            </span><span class="n">call</span><span class="p">:</span><span class="w"> </span><span class="n">Call</span><span class="o">&lt;</span><span class="n">WeatherData?&gt;</span><span class="p">,</span>
<span class="w">                            </span><span class="n">response</span><span class="p">:</span><span class="w"> </span><span class="n">Response</span><span class="o">&lt;</span><span class="n">WeatherData?&gt;</span>
<span class="w">                        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">isSuccessful</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                </span><span class="n">_state</span><span class="p">.</span><span class="na">tryEmit</span><span class="p">(</span><span class="n">WeatherState</span><span class="p">.</span><span class="na">Success</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">body</span><span class="p">()))</span>
<span class="w">                            </span><span class="p">}</span>
<span class="w">                        </span><span class="p">}</span>

<span class="w">                        </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onFailure</span><span class="p">(</span>
<span class="w">                            </span><span class="n">call</span><span class="p">:</span><span class="w"> </span><span class="n">Call</span><span class="o">&lt;</span><span class="n">WeatherData?&gt;</span><span class="p">,</span>
<span class="w">                            </span><span class="n">t</span><span class="p">:</span><span class="w"> </span><span class="n">Throwable</span>
<span class="w">                        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="n">t</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">()</span>
<span class="w">                            </span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WeatherState</span><span class="p">.</span><span class="na">Error</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">})</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">Exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WeatherState</span><span class="p">.</span><span class="na">Error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">Factory</span><span class="p">:</span><span class="w"> </span><span class="n">ViewModelProvider</span><span class="p">.</span><span class="na">Factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewModelFactory</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">initializer</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">savedStateHandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createSavedStateHandle</span><span class="p">()</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">weatherReposotory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WeatherInfoApplication</span><span class="p">.</span><span class="na">weatherRepository</span>
<span class="w">                </span><span class="n">WeatherViewModel</span><span class="p">(</span>
<span class="w">                    </span><span class="n">savedStateHandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">savedStateHandle</span><span class="p">,</span>
<span class="w">                    </span><span class="n">weatherRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weatherReposotory</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>A <code>WeatherViewModel</code> paraméterként megkapja az <code>IWeatherRepository</code> egy példányát, valamint egy <code>SavedStateHandle</code>-t a városnév paraméter kiolvasásához. Ezen kívül tárolja az állapotot, és a városnevet (a <code>SavedStateHandle</code>-ből kiolvasva). Egyetlen függvénye a hálózati hívást korutinnal elvégző <em>getWeather()</em>. Tartalmazza még a saját példányosításához szükséges <em>Factory method</em>-ot.</p>
<p>Látható, hogy a <em>getWeather</em> függvényben a <code>weatherRepository</code> <em>getWeather</em> függvényének válaszára (ami egy <em>Call<WeatherData></em> objektum, egy <em>callbacket</em> helyeztünk el. Ezzel tudjuk kezelni a hálózati hívásunk különböző állapotait.</p>
<h3 id="az-idojaras-felulet">Az időjárás felület<a class="headerlink" href="#az-idojaras-felulet" title="Permanent link">&para;</a></h3>
<h4 id="komponensek">Komponensek<a class="headerlink" href="#komponensek" title="Permanent link">&para;</a></h4>
<p>Az időjárás képernyőn a város neve, aktuális időjárásának jellemzése és egy ikon mellett a konkrét számszerű értékeket is ki szeretnénk írni. Ennek a megvalósításához hozzunk létre egy segéd <em>composable</em>-t a <code>hu.bme.aut.android.weatherinfo.feature.weather.components</code> <em>package</em>-ben, ami a szövegek és értékek egymás mellé írását fogja segíteni.</p>
<p><code>WeatherDataText.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.weather.components</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Arrangement</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Row</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxWidth</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.Text</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.tooling.preview.Preview</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.TextUnit</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.sp</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">WeatherDataText</span><span class="p">(</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">,</span>
<span class="w">    </span><span class="n">label</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">    </span><span class="n">textSize</span><span class="p">:</span><span class="w"> </span><span class="n">TextUnit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TextUnit</span><span class="p">.</span><span class="na">Unspecified</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Row</span><span class="p">(</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">(),</span>
<span class="w">        </span><span class="n">horizontalArrangement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrangement</span><span class="p">.</span><span class="na">SpaceBetween</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Text</span><span class="p">(</span>
<span class="w">            </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">label</span><span class="p">,</span>
<span class="w">            </span><span class="n">fontSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">textSize</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">Text</span><span class="p">(</span>
<span class="w">            </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">fontSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">textSize</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@Composable</span>
<span class="nd">@Preview</span><span class="p">(</span><span class="n">showBackground</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">WeatherDataTextPreview</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">WeatherDataText</span><span class="p">(</span>
<span class="w">        </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Temperature&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;20&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">textSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16.</span><span class="n">sp</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="a-weatherscreen-elkeszitese">A WeatherScreen elkészítése<a class="headerlink" href="#a-weatherscreen-elkeszitese" title="Permanent link">&para;</a></h3>
<p>Most már minden készen áll ahhoz, hogy elkészítsük az időjárás képernyőnket a <code>hu.bme.aut.android.weatherinfo.feature.weather</code> <em>package</em>-ben.</p>
<p><code>WeatherScreen.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.weather</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Box</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Column</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Spacer</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxSize</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.padding</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.size</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.Icons</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material.icons.automirrored.filled.ArrowBack</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.CircularProgressIndicator</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.ExperimentalMaterial3Api</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.Icon</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.IconButton</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.MaterialTheme</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.Scaffold</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.Text</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.TopAppBar</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.TopAppBarDefaults</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Alignment</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.layout.ContentScale</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.platform.LocalContext</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.res.painterResource</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.res.stringResource</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.tooling.preview.Preview</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.dp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.sp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.compose.collectAsStateWithLifecycle</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.viewmodel.compose.viewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">coil.compose.AsyncImage</span>
<span class="k">import</span><span class="w"> </span><span class="nn">coil.request.ImageRequest</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.R</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.weather.components.WeatherDataText</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.weather.state.WeatherState</span>

<span class="nd">@OptIn</span><span class="p">(</span><span class="n">ExperimentalMaterial3Api</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">WeatherScreen</span><span class="p">(</span>
<span class="w">    </span><span class="n">weatherViewModel</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewModel</span><span class="p">(</span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WeatherViewModel</span><span class="p">.</span><span class="na">Factory</span><span class="p">),</span>
<span class="w">    </span><span class="n">onNavigateBack</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weatherViewModel</span><span class="p">.</span><span class="na">state</span><span class="p">.</span><span class="na">collectAsStateWithLifecycle</span><span class="p">().</span><span class="na">value</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">cityName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weatherViewModel</span><span class="p">.</span><span class="na">cityName</span><span class="p">.</span><span class="na">collectAsStateWithLifecycle</span><span class="p">().</span><span class="na">value</span>

<span class="w">    </span><span class="n">Scaffold</span><span class="p">(</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">            </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">(),</span>
<span class="w">        </span><span class="n">topBar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">TopAppBar</span><span class="p">(</span>
<span class="w">                </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">weather_in</span><span class="p">,</span><span class="w"> </span><span class="n">cityName</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">                </span><span class="n">navigationIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">IconButton</span><span class="p">(</span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">onNavigateBack</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">Icon</span><span class="p">(</span>
<span class="w">                            </span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">AutoMirrored</span><span class="p">.</span><span class="na">Filled</span><span class="p">.</span><span class="na">ArrowBack</span><span class="p">,</span>
<span class="w">                            </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TopAppBarDefaults</span><span class="p">.</span><span class="na">topAppBarColors</span><span class="p">(</span>
<span class="w">                    </span><span class="n">containerColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colorScheme</span><span class="p">.</span><span class="na">primary</span><span class="p">,</span>
<span class="w">                    </span><span class="n">titleContentColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colorScheme</span><span class="p">.</span><span class="na">onPrimary</span><span class="p">,</span>
<span class="w">                    </span><span class="n">navigationIconContentColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colorScheme</span><span class="p">.</span><span class="na">onPrimary</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">innerPadding</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="n">Box</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="n">innerPadding</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">is</span><span class="w"> </span><span class="n">WeatherState</span><span class="p">.</span><span class="na">Loading</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">CircularProgressIndicator</span><span class="p">(</span>
<span class="w">                        </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colorScheme</span><span class="p">.</span><span class="na">secondaryContainer</span><span class="p">,</span>
<span class="w">                        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">align</span><span class="p">(</span><span class="n">Alignment</span><span class="p">.</span><span class="na">Center</span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="k">is</span><span class="w"> </span><span class="n">WeatherState</span><span class="p">.</span><span class="na">Error</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Text</span><span class="p">(</span>
<span class="w">                        </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">error</span><span class="p">.</span><span class="na">message</span><span class="p">.</span><span class="na">toString</span><span class="p">()</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="k">is</span><span class="w"> </span><span class="n">WeatherState</span><span class="p">.</span><span class="na">Success</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Column</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">Text</span><span class="p">(</span>
<span class="w">                            </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">weatherData</span><span class="o">?.</span><span class="na">weather</span><span class="o">?.</span><span class="na">get</span><span class="p">(</span><span class="m">0</span><span class="p">)</span><span class="o">?.</span><span class="na">description</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="n">fontSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24.</span><span class="n">sp</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                        </span><span class="n">AsyncImage</span><span class="p">(</span>
<span class="w">                            </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImageRequest</span><span class="p">.</span><span class="na">Builder</span><span class="p">(</span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalContext</span><span class="p">.</span><span class="na">current</span><span class="p">)</span>
<span class="w">                                </span><span class="p">.</span><span class="na">data</span><span class="p">(</span><span class="s">&quot;https://openweathermap.org/img/w/</span><span class="si">${</span><span class="n">state</span><span class="p">.</span><span class="na">weatherData</span><span class="o">?.</span><span class="na">weather</span><span class="o">?.</span><span class="na">first</span><span class="p">()</span><span class="o">?.</span><span class="na">icon</span><span class="si">}</span><span class="s">.png&quot;</span><span class="p">)</span>
<span class="w">                                </span><span class="p">.</span><span class="na">crossfade</span><span class="p">(</span><span class="n">enable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">                                </span><span class="p">.</span><span class="na">build</span><span class="p">(),</span>
<span class="w">                            </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">                            </span><span class="n">contentScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContentScale</span><span class="p">.</span><span class="na">Crop</span><span class="p">,</span>
<span class="w">                            </span><span class="n">placeholder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">painterResource</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">drawable</span><span class="p">.</span><span class="na">ic_placeholder</span><span class="p">),</span>
<span class="w">                            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                                </span><span class="p">.</span><span class="na">size</span><span class="p">(</span><span class="m">320.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                                </span><span class="p">.</span><span class="na">align</span><span class="p">(</span><span class="n">Alignment</span><span class="p">.</span><span class="na">CenterHorizontally</span><span class="p">)</span>
<span class="w">                        </span><span class="p">)</span>

<span class="w">                        </span><span class="n">Spacer</span><span class="p">(</span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">size</span><span class="p">(</span><span class="m">24.</span><span class="n">dp</span><span class="p">))</span>

<span class="w">                        </span><span class="n">WeatherDataText</span><span class="p">(</span>
<span class="w">                            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">0.</span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="m">8.</span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="m">0.</span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">                            </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_temperature</span><span class="p">),</span>
<span class="w">                            </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;</span><span class="si">${</span><span class="n">state</span><span class="p">.</span><span class="na">weatherData</span><span class="o">?.</span><span class="na">main</span><span class="o">?.</span><span class="na">temp</span><span class="si">}</span><span class="s"> \u2103&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="n">textSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24.</span><span class="n">sp</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                        </span><span class="n">WeatherDataText</span><span class="p">(</span>
<span class="w">                            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">0.</span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="m">8.</span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="m">0.</span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">                            </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_min_temperature</span><span class="p">),</span>
<span class="w">                            </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;</span><span class="si">${</span><span class="n">state</span><span class="p">.</span><span class="na">weatherData</span><span class="o">?.</span><span class="na">main</span><span class="o">?.</span><span class="na">temp_min</span><span class="si">}</span><span class="s"> \u2103&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="n">textSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24.</span><span class="n">sp</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                        </span><span class="n">WeatherDataText</span><span class="p">(</span>
<span class="w">                            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">0.</span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="m">8.</span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="m">0.</span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">                            </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_max_temperature</span><span class="p">),</span>
<span class="w">                            </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;</span><span class="si">${</span><span class="n">state</span><span class="p">.</span><span class="na">weatherData</span><span class="o">?.</span><span class="na">main</span><span class="o">?.</span><span class="na">temp_max</span><span class="si">}</span><span class="s"> \u2103&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="n">textSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24.</span><span class="n">sp</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                        </span><span class="n">WeatherDataText</span><span class="p">(</span>
<span class="w">                            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">0.</span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="m">8.</span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="m">0.</span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">                            </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_pressure</span><span class="p">),</span>
<span class="w">                            </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;</span><span class="si">${</span><span class="n">state</span><span class="p">.</span><span class="na">weatherData</span><span class="o">?.</span><span class="na">main</span><span class="o">?.</span><span class="na">pressure</span><span class="si">}</span><span class="s"> hPa&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="n">textSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24.</span><span class="n">sp</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                        </span><span class="n">WeatherDataText</span><span class="p">(</span>
<span class="w">                            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">0.</span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="m">8.</span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="m">0.</span><span class="n">dp</span><span class="p">,</span><span class="w"> </span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">                            </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">label_humidity</span><span class="p">),</span>
<span class="w">                            </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;</span><span class="si">${</span><span class="n">state</span><span class="p">.</span><span class="na">weatherData</span><span class="o">?.</span><span class="na">main</span><span class="o">?.</span><span class="na">humidity</span><span class="si">}</span><span class="s"> %&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="n">textSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24.</span><span class="n">sp</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@Composable</span>
<span class="nd">@Preview</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">WeatherScreenPreview</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">WeatherScreen</span><span class="p">(</span><span class="n">onNavigateBack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span>
<span class="p">}</span>
</code></pre></div>
<p>A felületünk vázát egy <code>Scaffold</code> adja, amiben <em>topBar</em>-on kiírjuk a város nevét és felteszünk egy vissza navigációs ikont. Figyeljük meg, hogy hogyan írunk ki paraméteres <em>stringet</em> az erőforrások közül.</p>
<p>Az oldal tartalma pedig állapottól függően vagy egy <code>CircularProgressIndicator</code>, vagy egy hiba szöveg, vagy pedig az adott város időjárásának adatai. </p>
<p>Figyeljük meg, hogy hogyan használjuk a kódban a <em>Coil</em> library <em>AsyncImage</em> függvényét a weben található kép megjelenítésére!</p>
<h4 id="bekotes-a-navigacioba">Bekötés a navigációba<a class="headerlink" href="#bekotes-a-navigacioba" title="Permanent link">&para;</a></h4>
<p>Egészítsük ki a <code>Screen</code> osztályunkat az új képernyővel.</p>
<p><code>Screen.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.navigation</span>

<span class="kd">sealed</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Screen</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">route</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">CityListScreen</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Screen</span><span class="p">(</span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;city_list&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="kd">object</span><span class="w"> </span><span class="nc">WeatherScreen</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Screen</span><span class="p">(</span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;weather/{</span><span class="si">${</span><span class="n">Args</span><span class="p">.</span><span class="na">cityName</span><span class="si">}</span><span class="s">}&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">fun</span><span class="w"> </span><span class="nf">passCityName</span><span class="p">(</span><span class="n">cityName</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;weather/</span><span class="si">$</span><span class="n">cityName</span><span class="s">&quot;</span>

<span class="w">        </span><span class="kd">object</span><span class="w"> </span><span class="nc">Args</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">cityName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cityName&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Figyeljük meg, hogy hogyan valósítjuk meg azt, hogy a <code>WeatherScreen</code>-nek paraméterül át lehessen adni a városnevet.</p>
<p>Ezek után a frissített <code>NavGraph</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.navigation</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.NavHostController</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.NavType</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.compose.NavHost</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.compose.composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.compose.rememberNavController</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.navigation.navArgument</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.citylist.CityListScreen</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.feature.weather.WeatherScreen</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">NavGraph</span><span class="p">(</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">,</span>
<span class="w">    </span><span class="n">navController</span><span class="p">:</span><span class="w"> </span><span class="n">NavHostController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rememberNavController</span><span class="p">(),</span>
<span class="w">    </span><span class="n">startDestination</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Screen</span><span class="p">.</span><span class="na">CityListScreen</span><span class="p">.</span><span class="na">route</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">NavHost</span><span class="p">(</span>
<span class="w">        </span><span class="n">navController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">navController</span><span class="p">,</span>
<span class="w">        </span><span class="n">startDestination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startDestination</span><span class="p">,</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">composable</span><span class="p">(</span><span class="n">Screen</span><span class="p">.</span><span class="na">CityListScreen</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">CityListScreen</span><span class="p">(</span>
<span class="w">                </span><span class="n">onCityClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">navController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Screen</span><span class="p">.</span><span class="na">WeatherScreen</span><span class="p">.</span><span class="na">passCityName</span><span class="p">(</span><span class="n">cityName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">it</span><span class="p">))</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">composable</span><span class="p">(</span>
<span class="w">            </span><span class="n">Screen</span><span class="p">.</span><span class="na">WeatherScreen</span><span class="p">.</span><span class="na">route</span><span class="p">,</span>
<span class="w">            </span><span class="n">arguments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listOf</span><span class="p">(</span><span class="n">navArgument</span><span class="p">(</span><span class="n">Screen</span><span class="p">.</span><span class="na">WeatherScreen</span><span class="p">.</span><span class="na">Args</span><span class="p">.</span><span class="na">cityName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">defaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Budapest&quot;</span>
<span class="w">                </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NavType</span><span class="p">.</span><span class="na">StringType</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">WeatherScreen</span><span class="p">(</span><span class="n">onNavigateBack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">navController</span><span class="p">.</span><span class="na">popBackStack</span><span class="p">()</span><span class="w"> </span><span class="p">})</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Próbáljuk ki az alkalmazást!</p>
<p>Az időjárás képernyőnk megjelenik, ott van a felirat a fejlécen, de a valós adatok nem láthatóak, hiszen a <em>repository</em>-nk mindig egy <em>null</em> adattal tér vissza. Ezért csak a töltő képernyőt látjuk.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Ha meg akarjuk nézni a <code>WeatherScreen</code>-t teljes egészében, írjuk át a <em>getWeather</em> függvény elején az állapotot <em>Loading</em>-ról <em>Success</em>-re.</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">_state</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WeatherState</span><span class="p">.</span><span class="na">Success</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="p">...</span>
</code></pre></div>
</div>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts egy <strong>képernyőképet</strong>, amelyen látszik az <strong>időjárás nézet a megfelelő fejléccel</strong> (emulátoron, készüléket tükrözve vagy képernyőfelvétellel), a <strong>WeatherScreen</strong> kódja, valamint a <strong>neptun kódod a kódban valahol kommentként</strong>! A képet a megoldásban a repository-ba f2.png néven töltsd föl! </p>
<p>A képernyőkép szükséges feltétele a pontszám megszerzésének.</p>
</div>
<h2 id="a-halozati-kommunikacio-elkeszitese-1-pont">A Hálózati kommunikáció elkészítése (1 pont)<a class="headerlink" href="#a-halozati-kommunikacio-elkeszitese-1-pont" title="Permanent link">&para;</a></h2>
<h3 id="a-weatherapi-megvalositasa">A WeatherAPI megvalósítása<a class="headerlink" href="#a-weatherapi-megvalositasa" title="Permanent link">&para;</a></h3>
<p>A hálózati kérések végrahajtásához a <code>Retrofit</code> külső könyvtárat fogjuk használni. Ennek a függőségeit már a labor elején felvettük a megfelelő helyre, most már csak alkalmazni fogjuk a könyvtár funkcióit.</p>
<p>Hozzunk létre a <code>hu.bme.aut.android.weatherinfo.data.network</code> csomagban egy <code>WeatherApi</code> Kotlin fájlt.</p>
<p><code>WeatherApi.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.network</span>

<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.network.model.WeatherData</span>
<span class="k">import</span><span class="w"> </span><span class="nn">retrofit2.Call</span>
<span class="k">import</span><span class="w"> </span><span class="nn">retrofit2.http.GET</span>
<span class="k">import</span><span class="w"> </span><span class="nn">retrofit2.http.Query</span>

<span class="kd">interface</span><span class="w"> </span><span class="nc">WeatherApi</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@GET</span><span class="p">(</span><span class="s">&quot;/data/2.5/weather&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getWeather</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;q&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">cityName</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;units&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">units</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span>
<span class="w">        </span><span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;appid&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">appId</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span>
<span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">Call</span><span class="o">&lt;</span><span class="n">WeatherData?&gt;</span><span class="o">?</span>
<span class="p">}</span>
</code></pre></div>
<p>Látható, hogy a <em>Retrofit</em>-ben annotációk alkalmazásával tuduk jelezni, hogy az adott függvényhívás milyen hálózati hívásnak fog megfelelni. A <code>@GET</code> annotáció <em>HTTP GET</em> kérést jelent, a paraméterként adott <em>string</em> pedig azt jelzi, hogy hogy a szerver alap <em>URL</em>-éhez képest melyik végpontra szeretnénk küldeni a kérést.</p>
<div class="admonition note">
<p>Hasonló módon tudjuk leírni a többi <em>HTTP</em> kérés típust is: <em>@POST</em>, <em>@UPDATE</em>, <em>@PATCH</em>, <em>@DELETE</em></p>
</div>
<p>A függvény paremétereit a <em>@Query</em> annotációval láttuk el. Ez azt jelenti, hogy a Retrofit az adott paraméter értékét a kéréshez fűzi <em>query</em> paraméterként, az annotációban megadott kulccsal.</p>
<div class="admonition note">
<p>További említésre méltó annotációk a teljesség igénye nélkül: @HEAD, @Multipart, @Field</p>
</div>
<h3 id="a-retrofitweatherrepository-frissitese">A RetrofitWeatherRepository frissítése<a class="headerlink" href="#a-retrofitweatherrepository-frissitese" title="Permanent link">&para;</a></h3>
<p>Most már készen áll az <em>interface</em>-ünk arra, hogy hálózati hívásokat végezzünk rajta keresztül. Cseréljük tehát le a <code>RetrofitWeatherRepository</code> <em>getWeather</em> függvényében visszaadott <em>null</em> értéket az igazi megvalósításra.</p>
<p><code>RetrofitWeatherRepository.kt</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.network.repository</span>

<span class="k">import</span><span class="w"> </span><span class="nn">com.squareup.moshi.Moshi</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.squareup.moshi.kotlin.reflect.KotlinJsonAdapterFactory</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.network.WeatherApi</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.weatherinfo.data.network.model.WeatherData</span>
<span class="k">import</span><span class="w"> </span><span class="nn">okhttp3.OkHttpClient</span>
<span class="k">import</span><span class="w"> </span><span class="nn">retrofit2.Call</span>
<span class="k">import</span><span class="w"> </span><span class="nn">retrofit2.Retrofit</span>
<span class="k">import</span><span class="w"> </span><span class="nn">retrofit2.converter.moshi.MoshiConverterFactory</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">RetrofitWeatherRepository</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IWeatherRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">retrofit</span><span class="p">:</span><span class="w"> </span><span class="n">Retrofit</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">weatherApi</span><span class="p">:</span><span class="w"> </span><span class="n">WeatherApi</span>

<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">SERVICE_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;https://api.openweathermap.org&quot;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">APP_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;APP_ID&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">init</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">moshi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Moshi</span><span class="p">.</span><span class="na">Builder</span><span class="p">().</span><span class="na">addLast</span><span class="p">(</span><span class="n">KotlinJsonAdapterFactory</span><span class="p">()).</span><span class="na">build</span><span class="p">()</span>
<span class="w">        </span><span class="n">retrofit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Retrofit</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">baseUrl</span><span class="p">(</span><span class="n">SERVICE_URL</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">client</span><span class="p">(</span><span class="n">OkHttpClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">().</span><span class="na">build</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">addConverterFactory</span><span class="p">(</span><span class="n">MoshiConverterFactory</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">moshi</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">        </span><span class="n">weatherApi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">retrofit</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">WeatherApi</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getWeather</span><span class="p">(</span><span class="n">city</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">):</span><span class="w"> </span><span class="n">Call</span><span class="o">&lt;</span><span class="n">WeatherData?&gt;</span><span class="o">?</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">weatherApi</span><span class="p">.</span><span class="na">getWeather</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;metric&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">APP_ID</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Ez az osztály lesz felelős a hálózati kérések lebonyolításáért. </p>
<p>A <code>Retrofit.Builder()</code> hívással kérhetünk egy pareméterezhető <code>Builder</code> példányt. Ebben adhatjuk meg a hálózati hívásaink tulajdonságait. Jelen példában beállítjuk az elérni kívánt szolgáltatás címét, a HTTP kliens implementációt (<a href="http://square.github.io/okhttp/">OkHttp</a>), valamint a JSON és objektum reprezentációk közötti konvertert (Moshi).</p>
<p>A <code>WeatherApi</code> interfészből a <code>Builder</code>-rel létrehozott <code>Retrofit</code> példány segítségével tudjuk elkérni a fordítási időben generált, paraméterezett implementációt.</p>
<p>A <code>retrofit.create(WeatherApi.class)</code> hívás eredményeként kapott objektum megvalósítja a <code>WeatherApi</code> interfészt.  Ha ezen az objektumon meghívjuk a <code>getWeather(...)</code> függvényt, akkor megtörténik az általunk az interfészben definiált hálózati hívás. </p>
<p><strong>Cseréljük le</strong> az <code>APP_ID</code> értékét az <a href="https://openweathermap.org/">OpenWeatherMap</a> oldalon kapott saját API kulcsunkra!</p>
<p>Próbáljuk ki az alkalmazást!</p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts egy <strong>képernyőképet</strong>, amelyen látszik az emulátoron egy <strong>város időjárása</strong> (emulátoron, készüléket tükrözve vagy képernyőfelvétellel), a <strong>RetrofitWeatherRepository</strong> kódja, valamint a <strong>neptun kódod a kódban valahol kommentként</strong>! A képet a megoldásban a repository-ba f3.png néven töltsd föl! </p>
<p>A képernyőkép szükséges feltétele a pontszám megszerzésének.</p>
</div>
<h2 id="onallo-feladat-varos-listabol-torles-megvalositasa-1-pont">Önálló feladat: város listából törlés megvalósítása (1 pont)<a class="headerlink" href="#onallo-feladat-varos-listabol-torles-megvalositasa-1-pont" title="Permanent link">&para;</a></h2>
<p>Valósítsuk meg a városok törlését az elemek balra elhúzásának hatására.</p>
<details class="success">
<summary>A megvalósítás lépései</summary>
<ul>
<li>törlés függvény a <em>repository interface</em>-be</li>
<li>törlés függvény a <em>rapository</em>-ba</li>
<li>törlés függvény a <em>viewmodel</em>-be</li>
<li>törlés eseménykezelő a <em>CityListScreen</em>-be</li>
</ul>
</details>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts egy <strong>képernyőképet</strong>, amelyen látszik az emulátoron a <strong>városok listája CSAK Budapesttel</strong> (emulátoron, készüléket tükrözve vagy képernyőfelvétellel), a <strong>törlés releváns</strong> kódrészlete, valamint a <strong>neptun kódod a kódban valahol kommentként</strong>! A képet a megoldásban a repository-ba f4.png néven töltsd föl!</p>
<p>A képernyőkép szükséges feltétele a pontszám megszerzésének.</p>
</div>

    <hr>
  <div class="md-source-file">
    <span class="md-source-file__fact"> <span class="md-icon" title="Utolsó frissítés"> <svg
          xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z">
          </path>
        </svg>
      </span>
      <span title="2024. október 11. 22:28:25">
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-10-11T22:28:25+02:00" locale="hu"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-10-11</span>
      </span>
    </span>

    

    <span class="md-source-file__fact">
      <span class="md-icon" title="Szerzők">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z">
          </path>
        </svg>
      </span>
      <span>Szerzők</span>
      <nav><a href="https://github.com/gazdilaci" target="_blank" rel="noopener noreferrer" class="md-author" title="@gazdilaci">
          <img src="https://avatars.githubusercontent.com/u/23335752?v=4?size=72" alt="@gazdilaci">
        </a><a href="https://github.com/AlmosF" target="_blank" rel="noopener noreferrer" class="md-author" title="@AlmosF">
          <img src="https://avatars.githubusercontent.com/u/92093359?v=4?size=72" alt="@AlmosF">
        </a><a href="https://github.com/kpomazi" target="_blank" rel="noopener noreferrer" class="md-author" title="@kpomazi">
          <img src="https://avatars.githubusercontent.com/u/22079595?v=4?size=72" alt="@kpomazi">
        </a><a href="https://github.com/web-flow" target="_blank" rel="noopener noreferrer" class="md-author" title="@web-flow">
          <img src="https://avatars.githubusercontent.com/u/19864447?v=4?size=72" alt="@web-flow">
        </a></nav>      
    </span>
  </div>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; BME VIK AUT
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.top", "search.suggest"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "V\u00e1g\u00f3lapra m\u00e1solva", "clipboard.copy": "M\u00e1sol\u00e1s v\u00e1g\u00f3lapra", "search.result.more.one": "1 tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.more.other": "# tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.none": "Nincs tal\u00e1lat", "search.result.one": "1 egyez\u0151 dokumentum", "search.result.other": "# egyez\u0151 dokumentum", "search.result.placeholder": "Keres\u00e9shez \u00edrj ide valamit", "search.result.term.missing": "\u00dcres", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ba449ae6.min.js"></script>
      
        <script src="../../js/timeago.min.js"></script>
      
        <script src="../../js/timeago_mkdocs_material.js"></script>
      
    
  </body>
</html>